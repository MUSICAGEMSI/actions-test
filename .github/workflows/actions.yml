name: Executar Scripts Diariamente

on:
  schedule:
    - cron: '0 12 12 * *'  # Todo dia 12 √†s 12:00 UTC (09h Bras√≠lia)
  workflow_dispatch:       # Permite disparo manual
  
jobs:
  run-scripts:
    runs-on: ubuntu-latest
    timeout-minutes: 60    # Timeout de 60 minutos para evitar execu√ß√£o infinita
    
    env:
      LOGIN_MUSICAL: ${{ secrets.LOGIN_MUSICAL }}
      SENHA_MUSICAL: ${{ secrets.SENHA_MUSICAL }}
      
    steps:
      - name: Clonar o reposit√≥rio
        uses: actions/checkout@v4  # Vers√£o mais recente
        
      - name: Configurar Python
        uses: actions/setup-python@v5  # Vers√£o mais recente
        with:
          python-version: '3.11'  # Vers√£o mais est√°vel
          
      - name: Cache de depend√™ncias Python
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
            
      - name: Criar requirements.txt se n√£o existir
        run: |
          if [ ! -f requirements.txt ]; then
            echo "playwright==1.40.0" > requirements.txt
            echo "requests==2.31.0" >> requirements.txt
            echo "beautifulsoup4==4.12.2" >> requirements.txt
            echo "lxml==4.9.3" >> requirements.txt
          fi
          
      - name: Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Instalar navegadores Playwright
        run: |
          python -m playwright install chromium
          python -m playwright install-deps
          
      - name: Verificar arquivos do projeto
        run: |
          echo "üìÅ Arquivos no diret√≥rio:"
          ls -la
          echo "üêç Scripts Python encontrados:"
          find . -name "*.py" -type f
          
      - name: Executar script de debug
        run: |
          echo "üêõ Executando vers√£o DEBUG do script"
          python script_debug_completo.py
          
      - name: Upload arquivos de debug
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: debug-files
          path: |
            debug_*.html
            debug_*.txt
          retention-days: 3
          
      - name: Upload de logs em caso de erro
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: execution-logs
          path: |
            *.log
            /home/runner/.cache/ms-playwright/
          retention-days: 7
